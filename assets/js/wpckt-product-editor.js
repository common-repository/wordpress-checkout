/**
 * Wordpress Checkout 
 * Plugin URI: http://wordpress-checkout.com/
 *
*/

var wpcktShortcode=wpcktShortcode||{};(function(e){e(document).ready(function(){wpcktShortcode.Update();e(".wpckt-add-product").on("click",function(i){var j=e(this),h=j.data("editor"),g={frame:"post",state:"iframe:wpckt",title:"Insert Product",multiple:true};i.preventDefault();j.blur();wp.media.editor.open(h,g)});e(".wpckt-section").each(function(g,h){var i=e(this);if(i.is(":checked")){if(!i.hasClass("product")){wpcktShortcode.Update(i)}else{wpcktShortcode.Update()}}});e(".wpckt-insert-product").on("click",function(i){i.preventDefault();var h=parent.wp;if(e(".wpckt-section").not(".product").is(":checked")){var g=a();wpcktSettings.action="wpckt_editor_insert_shortcode";wpcktSettings.code=wpcktShortcode.Render();if(typeof g.post_id!="undefined"){wpcktSettings.post_id=g.post_id}c(wpcktSettings,function(j){if(typeof j!="undefined"){wpcktShortcode.Insert();return}})}else{if(wpcktShortcode.Validate()){wpcktShortcode.Insert()}}});e(".wpckt-update-product").on("click",function(g){g.preventDefault();wpcktShortcode.Insert(true)});e(".wpckt-sc").on("blur",function(g){$this=e(this);if($this.hasClass("format")){if(b($this.val().replace(",","."))){d($this);wpcktSettings.action="wpckt_format";wpcktSettings.types=$this.prop("class");wpcktSettings.amount=$this.val();c(wpcktSettings,function(h){if(typeof h!="undefined"){$this.val(h.value);wpcktShortcode.Update();f();return}})}else{$this.val("");return}}else{wpcktShortcode.Update()}}).on("click",function(){var i=e(this);var h=i.is(":checked");var g=false;if(i.hasClass("wpckt-section")){if(!i.hasClass("product")){g=true;e(".product-table").addClass("wpckt-opaque");wpcktShortcode.Update(i)}else{e(".product-table").removeClass("wpckt-opaque");wpcktShortcode.Update()}e(".enabled").prop("disabled",g);return true}i.removeClass("wpckt-wrong-field");wpcktShortcode.Update()})});wpcktShortcode={settings:{start:"[wp_checkout",end:"]",shortcodeFields:".wpckt-sc",shortcodeTextArea:"#wpckt_shortcode"},code:[],Update:function(h){this.code=[];if(typeof h!="undefined"){this.Populate(h)}else{var g=this;e.each(e(this.settings.shortcodeFields),function(){var i=e(this);g.Populate(i)})}this.Render()},Populate:function(h){if(h.is(":checkbox")){if(h.is(":checked")){this.code[h.prop("name")]=h.prop("value")}else{this.code[h.prop("name")]=""}}else{if(h.is(":radio")){if(h.is(":checked")){this.code.section=h.prop("value")}}else{var g=h.prop("value");this.code[h.prop("name")]=g.replace(/"/g,"'")}}},Render:function(){var h=this.settings.start;for(var g in this.code){if(this.code[g]!=""){h+=" "+g+'="'+this.code[g]+'"'}}h+=this.settings.end;e(this.settings.shortcodeTextArea).val(h);return h},Validate:function(){e.each(e(".required"),function(g,h){var i=e(this);if(i.prop("value")==""){i.addClass("wpckt-wrong-field").prop("placeholder","required")}i.on("click",function(j){j.preventDefault();e(this).removeClass("wpckt-wrong-field")})});if(e(".wpckt-wrong-field").size()>0){return false}else{return true}},Insert:function(o){var l=(window.dialogArguments||opener||parent||top),q=l.tinymce,p=typeof(q)!="undefined",g=l.QTags,n=typeof(g)!="undefined",j=l.wpActiveEditor,k,i=this.Render();if(window.send_to_editor){return window.send_to_editor.apply(this,arguments)}if(!j){if(p&&q.activeEditor){k=q.activeEditor;j=window.wpActiveEditor=k.id}else{if(!n){return false}}}else{if(p){if(q.activeEditor&&(q.activeEditor.id=="mce_fullscreen"||q.activeEditor.id=="wp_mce_fullscreen")){k=q.activeEditor}else{k=q.get(j)}}}if(k&&!k.isHidden()){if(o){k.execCommand("WP_Checkout_Remove")}if(q.isIE&&k.windowManager.insertimagebookmark){k.selection.moveToBookmark(k.windowManager.insertimagebookmark)}if(i.indexOf("[wp_checkout")!==-1){if(k.plugins.wpcheckout){i=k.plugins.wpcheckout._do_wpckt_label(i)}}k.execCommand("mceInsertContent",false,i)}else{if(n){g.insertContent(i)}else{document.getElementById(j).value+=i}}if(o){k.windowManager.close(window)}else{var m=l.wp.media.editor.get();m.close()}},GetAttrs:function(j){var g=[],i,h;i=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*\'([^\']*)\'(?:\s|$)|(\w+)\s*=\s*([^\s\'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/g;j=j.replace(/[\u00a0\u200b]/g," ");while((h=i.exec(j))){if(h[1]){g[h[1].toLowerCase()]=h[2]}else{if(h[3]){g[h[3].toLowerCase()]=h[4]}else{if(h[5]){g[h[5].toLowerCase()]=h[6]}}}}return g}};function c(g,h){e.post(g.ajaxUrl,g,h,"json")}function d(h){var g=h.siblings(".wpckt-spinner");if(g.size()==0){h.after('<div class="wpckt-spinner"></div>')}else{g.show()}}function f(){e(".wpckt-spinner").hide()}function b(g){return(g-0)==g&&(g+"").replace(/^\s+|\s+$/g,"").length>0}function a(){var k=[],j;var g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var h=0;h<g.length;h++){j=g[h].split("=");k[j[0]]=j[1]}return k}}(jQuery));
