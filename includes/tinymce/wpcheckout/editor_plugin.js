(function(){tinymce.create("tinymce.plugins.wpcheckout",{init:function(e,t){var n=this;n.url=t;n.editor=e;n._createWpcktButtons();n._hideButtons(e);e.addCommand("WP_Checkout",function(){if(tinymce.isIE)e.selection.moveToBookmark(e.wpCheckoutBookmark);var t=e.selection.getNode(),r,i="";if(typeof wp==="undefined"||!wp.media||typeof wpcktShortcode==="undefined"){return}if(e.dom.getAttrib(t,"class").indexOf("wp-checkout")==-1)return;var s=e.dom.getAttrib(t,"title");r=wpcktShortcode.GetAttrs(s);for(var o in r){if(r[o]!="")i+=o+"="+escape(r[o])+"&"}n._openEditor(i)});e.addCommand("WP_Checkout_Remove",function(t){var n=e.selection.getNode();e.dom.remove(n);e.execCommand("mceRepaint")});e.onInit.add(function(e){if("ontouchstart"in window){e.dom.events.add(e.getBody(),"touchstart",function(t){var n=t.target;if(n.nodeName=="IMG"&&e.dom.hasClass(n,"wp-checkout")){e.selection.select(n);e.dom.events.cancel(t);e.plugins.wordpress._hideButtons();e.plugins.wordpress._showButtons(n,"wp_checkoutbtns")}})}});e.onMouseDown.add(function(e,t){if(t.target.nodeName=="IMG"&&e.dom.hasClass(t.target,"wp-checkout")){e.plugins.wordpress._hideButtons();e.plugins.wordpress._showButtons(t.target,"wp_checkoutbtns")}});e.onBeforeSetContent.add(function(e,t){t.content=n._do_wpckt_label(t.content)});e.onPostProcess.add(function(e,t){if(t.get)t.content=n._get_wpckt_label(t.content)})},_do_wpckt_label:function(e){return e.replace(/\[wp_checkout([^\]]*)\]/g,function(e,t){var n=wpcktShortcode.GetAttrs(tinymce.DOM.encode(t));var r=n["width"]||"";var i=n["width_unit"]||"";var s=n["align"]||"";var o="";s=s.replace(/&quot;/g,"");switch(s){case"left":o="alignleft";break;case"right":o="alignright";break;case"center":o="aligncenter";break}return"<img "+'src="'+tinymce.baseURL+'/../../../wp-content/plugins/wordpress-checkout/includes/tinymce/wpcheckout/img/t.gif" '+'class="wp-checkout mceItem '+o+'" '+'title="wp_checkout'+tinymce.DOM.encode(t)+'"'+'style="width:'+r.replace(/&quot;/g,"")+i.replace(/&quot;/g,"")+'"'+"/>"})},_get_wpckt_label:function(e){function t(e,t){t=(new RegExp(t+'="([^"]+)"',"g")).exec(e);return t?tinymce.DOM.decode(t[1]):""}return e.replace(/(?:<p[^>]*>)*(<img[^>]+>)(?:<\/p>)*/g,function(e,n){var r=t(n,"class");if(r.indexOf("wp-checkout")!=-1)return"<p>["+tinymce.trim(t(n,"title"))+"]</p>";return e})},_createWpcktButtons:function(){var e=this,t=tinymce.activeEditor,n=tinymce.DOM,r,i,s;if(n.get("wp_checkoutbtns"))return;s=window.devicePixelRatio&&window.devicePixelRatio>1||window.matchMedia&&window.matchMedia("(min-resolution:130dpi)").matches;n.add(document.body,"div",{id:"wp_checkoutbtns",style:"display:none"});r=n.add("wp_checkoutbtns","img",{src:s?e.url+"/img/wp_checkout_label_edit_2x.png":e.url+"/img/wp_checkout_label_edit.png",id:"wp_editwpckt",width:"24",height:"24",title:t.getLang("wpckt.edit")});r.onmousedown=function(e){var t=tinymce.activeEditor;t.wpCheckoutBookmark=t.selection.getBookmark("simple");t.execCommand("WP_Checkout");t.plugins.wordpress._hideButtons()};i=n.add("wp_checkoutbtns","img",{src:s?e.url+"/img/delete-2x.png":e.url+"/img/delete.png",id:"wp_delwpckt",width:"24",height:"24",title:t.getLang("wpckt.delete")});i.onmousedown=function(e){var t=tinymce.activeEditor,n=t.selection.getNode();if(n.nodeName=="IMG"&&t.dom.hasClass(n,"wp-checkout")){t.dom.remove(n);t.execCommand("mceRepaint");t.dom.events.cancel(e)}t.plugins.wordpress._hideButtons()}},_hideButtons:function(e){var t=e.plugins.wordpress._hideButtons;e.plugins.wordpress._hideButtons=function(){t();var e=tinymce.DOM;e.hide(e.select("#wp_checkoutbtns"))}},_updateLabel:function(){var e=ed.plugins.wordpress._hideButtons;ed.plugins.wordpress._hideButtons=function(){e();var t=tinymce.DOM;t.hide(t.select("#wp_checkoutbtns"))}},_openEditor:function(e){var t=tinymce.activeEditor,n=this.url,r=t.selection.getNode(),i,s,o,u=r.className;if(u.indexOf("mceItem")==-1||u.indexOf("wp-checkout")==-1)return;i=tinymce.DOM.getViewPort();s=700<i.h-70?680:i.h-70;o=700<i.w?700:i.w;t.windowManager.open({file:tinymce.baseURL+"/../../../wp-admin/media-upload.php?chromeless=1&post_id=70&tab=wpckt&"+e,width:o+"px",height:s+"px",inline:true})},_closeEditor:function(e){var t=top.tinymce.activeEditor,n="mceModalBlocker";t.windowManager.close(null,n)},getInfo:function(){return{longname:"WP Checkput Shortcode Label",author:"Alain Gonzalez",authorurl:"http://wordpress-checkout.com",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("wpcheckout",tinymce.plugins.wpcheckout)})();